/*  Prototype JavaScript framework, version 1.4.0
 *  (c) 2005 Sam Stephenson <sam@conio.net>
 *
 *  Prototype is freely distributable under the terms of an MIT-style license.
 *  For details, see the Prototype web site: http://prototype.conio.net/
 *
 /*--------------------------------------------------------------------------*/
function $(){var a=new Array;for(var b=0;b<arguments.length;b++){var c=arguments[b];typeof c=="string"&&(c=document.getElementById(c));if(arguments.length==1)return c;a.push(c)}return a}function $H(a){var b=Object.extend({},a||{});return Object.extend(b,Enumerable),Object.extend(b,Hash),b}function getAllChildren(a){return a.all?a.all:a.getElementsByTagName("*")}var Prototype={Version:"1.4.0",ScriptFragment:"(?:<script.*?>)((\n|\r|.)*?)(?:</script>)",emptyFunction:function(){},K:function(a){return a}},Class={create:function(){return function(){this.initialize.apply(this,arguments)}}},Abstract=new Object;Object.extend=function(a,b){for(property in b)a[property]=b[property];return a},Object.inspect=function(a){try{return a==undefined?"undefined":a==null?"null":a.inspect?a.inspect():a.toString()}catch(b){if(b instanceof RangeError)return"...";throw b}},Function.prototype.bind=function(){var a=this,b=$A(arguments),c=b.shift();return function(){return a.apply(c,b.concat($A(arguments)))}},Function.prototype.bindAsEventListener=function(a){var b=this;return function(c){return b.call(a,c||window.event)}},Object.extend(Number.prototype,{toColorPart:function(){var a=this.toString(16);return this<16?"0"+a:a},succ:function(){return this+1},times:function(a){return $R(0,this,!0).each(a),this}});var Try={these:function(){var a;for(var b=0;b<arguments.length;b++){var c=arguments[b];try{a=c();break}catch(d){}}return a}},PeriodicalExecuter=Class.create();PeriodicalExecuter.prototype={initialize:function(a,b){this.callback=a,this.frequency=b,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.callback()}finally{this.currentlyExecuting=!1}}},Object.extend(String.prototype,{stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var a=new RegExp(Prototype.ScriptFragment,"img"),b=new RegExp(Prototype.ScriptFragment,"im");return(this.match(a)||[]).map(function(a){return(a.match(b)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(eval)},escapeHTML:function(){var a=document.createElement("div"),b=document.createTextNode(this);return a.appendChild(b),a.innerHTML},unescapeHTML:function(){var a=document.createElement("div");return a.innerHTML=this.stripTags(),a.childNodes[0]?a.childNodes[0].nodeValue:""},toQueryParams:function(){var a=this.match(/^\??(.*)$/)[1].split("&");return a.inject({},function(a,b){var c=b.split("=");return a[c[0]]=c[1],a})},toArray:function(){return this.split("")},camelize:function(){var a=this.split("-");if(a.length==1)return a[0];var b=this.indexOf("-")==0?a[0].charAt(0).toUpperCase()+a[0].substring(1):a[0];for(var c=1,d=a.length;c<d;c++){var e=a[c];b+=e.charAt(0).toUpperCase()+e.substring(1)}return b},inspect:function(){return"'"+this.replace("\\","\\\\").replace("'","\\'")+"'"}}),String.prototype.parseQuery=String.prototype.toQueryParams;var $break=new Object,$continue=new Object,Enumerable={each:function(a){var b=0;try{this._each(function(c){try{a(c,b++)}catch(d){if(d!=$continue)throw d}})}catch(c){if(c!=$break)throw c}},all:function(a){var b=!0;return this.each(function(c,d){b=b&&!!(a||Prototype.K)(c,d);if(!b)throw $break}),b},any:function(a){var b=!0;return this.each(function(c,d){if(b=!!(a||Prototype.K)(c,d))throw $break}),b},collect:function(a){var b=[];return this.each(function(c,d){b.push(a(c,d))}),b},detect:function(a){var b;return this.each(function(c,d){if(a(c,d))throw b=c,$break}),b},findAll:function(a){var b=[];return this.each(function(c,d){a(c,d)&&b.push(c)}),b},grep:function(a,b){var c=[];return this.each(function(d,e){var f=d.toString();f.match(a)&&c.push((b||Prototype.K)(d,e))}),c},include:function(a){var b=!1;return this.each(function(c){if(c==a)throw b=!0,$break}),b},inject:function(a,b){return this.each(function(c,d){a=b(a,c,d)}),a},invoke:function(a){var b=$A(arguments).slice(1);return this.collect(function(c){return c[a].apply(c,b)})},max:function(a){var b;return this.each(function(c,d){c=(a||Prototype.K)(c,d),c>=(b||c)&&(b=c)}),b},min:function(a){var b;return this.each(function(c,d){c=(a||Prototype.K)(c,d),c<=(b||c)&&(b=c)}),b},partition:function(a){var b=[],c=[];return this.each(function(d,e){((a||Prototype.K)(d,e)?b:c).push(d)}),[b,c]},pluck:function(a){var b=[];return this.each(function(c,d){b.push(c[a])}),b},reject:function(a){var b=[];return this.each(function(c,d){a(c,d)||b.push(c)}),b},sortBy:function(a){return this.collect(function(b,c){return{value:b,criteria:a(b,c)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}).pluck("value")},toArray:function(){return this.collect(Prototype.K)},zip:function(){var a=Prototype.K,b=$A(arguments);typeof b.last()=="function"&&(a=b.pop());var c=[this].concat(b).map($A);return this.map(function(b,d){return a(b=c.pluck(d)),b})},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray});var $A=Array.from=function(a){if(!a)return[];if(a.toArray)return a.toArray();var b=[];for(var c=0;c<a.length;c++)b.push(a[c]);return b};Object.extend(Array.prototype,Enumerable),Array.prototype._reverse=Array.prototype.reverse,Object.extend(Array.prototype,{_each:function(a){for(var b=0;b<this.length;b++)a(this[b])},clear:function(){return this.length=0,this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return a!=undefined||a!=null})},flatten:function(){return this.inject([],function(a,b){return a.concat(b.constructor==Array?b.flatten():[b])})},without:function(){var a=$A(arguments);return this.select(function(b){return!a.include(b)})},indexOf:function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1},reverse:function(a){return(a!==!1?this:this.toArray())._reverse()},shift:function(){var a=this[0];for(var b=0;b<this.length-1;b++)this[b]=this[b+1];return this.length--,a},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}});var Hash={_each:function(a){for(key in this){var b=this[key];if(typeof b=="function")continue;var c=[key,b];c.key=key,c.value=b,a(c)}},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},merge:function(a){return $H(a).inject($H(this),function(a,b){return a[b.key]=b.value,a})},toQueryString:function(){return this.map(function(a){return a.map(encodeURIComponent).join("=")}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"}};ObjectRange=Class.create(),Object.extend(ObjectRange.prototype,Enumerable),Object.extend(ObjectRange.prototype,{initialize:function(a,b,c){this.start=a,this.end=b,this.exclusive=c},_each:function(a){var b=this.start;do a(b),b=b.succ();while(this.include(b))},include:function(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}});var $R=function(a,b,c){return new ObjectRange(a,b,c)},Ajax={getTransport:function(){return Try.these(function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new XMLHttpRequest})||!1},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(a){this.responders._each(a)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,d){this.each(function(e){if(e[a]&&typeof e[a]=="function")try{e[a].apply(e,[b,c,d])}catch(f){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=function(){},Ajax.Base.prototype={setOptions:function(a){this.options={method:"post",asynchronous:!0,parameters:""},Object.extend(this.options,a||{})},responseIsSuccess:function(){return this.transport.status==undefined||this.transport.status==0||this.transport.status>=200&&this.transport.status<300},responseIsFailure:function(){return!this.responseIsSuccess()}},Ajax.Request=Class.create(),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Request.prototype=Object.extend(new Ajax.Base,{initialize:function(a,b){this.transport=Ajax.getTransport(),this.setOptions(b),this.request(a)},request:function(a){var b=this.options.parameters||"";b.length>0&&(b+="&_=");try{this.url=a,this.options.method=="get"&&b.length>0&&(this.url+=(this.url.match(/\?/)?"&":"?")+b),Ajax.Responders.dispatch("onCreate",this,this.transport),this.transport.open(this.options.method,this.url,this.options.asynchronous),this.options.asynchronous&&(this.transport.onreadystatechange=this.onStateChange.bind(this),setTimeout(function(){this.respondToReadyState(1)}.bind(this),10)),this.setRequestHeaders();var c=this.options.postBody?this.options.postBody:b;this.transport.send(this.options.method=="post"?c:null)}catch(d){this.dispatchException(d)}},setRequestHeaders:function(){var a=["X-Requested-With","XMLHttpRequest","X-Prototype-Version",Prototype.Version];this.options.method=="post"&&(a.push("Content-type","application/x-www-form-urlencoded"),this.transport.overrideMimeType&&a.push("Connection","close")),this.options.requestHeaders&&a.push.apply(a,this.options.requestHeaders);for(var b=0;b<a.length;b+=2)this.transport.setRequestHeader(a[b],a[b+1])},onStateChange:function(){var a=this.transport.readyState;a!=1&&this.respondToReadyState(this.transport.readyState)},header:function(a){try{return this.transport.getResponseHeader(a)}catch(b){}},evalJSON:function(){try{return eval(this.header("X-JSON"))}catch(e){}},evalResponse:function(){try{return eval(this.transport.responseText)}catch(e){this.dispatchException(e)}},respondToReadyState:function(a){var b=Ajax.Request.Events[a],c=this.transport,d=this.evalJSON();if(b=="Complete"){try{(this.options["on"+this.transport.status]||this.options["on"+(this.responseIsSuccess()?"Success":"Failure")]||Prototype.emptyFunction)(c,d)}catch(e){this.dispatchException(e)}(this.header("Content-type")||"").match(/^text\/javascript/i)&&this.evalResponse()}try{(this.options["on"+b]||Prototype.emptyFunction)(c,d),Ajax.Responders.dispatch("on"+b,this,c,d)}catch(e){this.dispatchException(e)}b=="Complete"&&(this.transport.onreadystatechange=Prototype.emptyFunction)},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a),Ajax.Responders.dispatch("onException",this,a)}}),Ajax.Updater=Class.create(),Object.extend(Object.extend(Ajax.Updater.prototype,Ajax.Request.prototype),{initialize:function(a,b,c){this.containers={success:a.success?$(a.success):$(a),failure:a.failure?$(a.failure):a.success?null:$(a)},this.transport=Ajax.getTransport(),this.setOptions(c);var d=this.options.onComplete||Prototype.emptyFunction;this.options.onComplete=function(a,b){this.updateContent(),d(a,b)}.bind(this),this.request(b)},updateContent:function(){var a=this.responseIsSuccess()?this.containers.success:this.containers.failure,b=this.transport.responseText;this.options.evalScripts||(b=b.stripScripts()),a&&(this.options.insertion?new this.options.insertion(a,b):Element.update(a,b)),this.responseIsSuccess()&&this.onComplete&&setTimeout(this.onComplete.bind(this),10)}}),Ajax.PeriodicalUpdater=Class.create(),Ajax.PeriodicalUpdater.prototype=Object.extend(new Ajax.Base,{initialize:function(a,b,c){this.setOptions(c),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=a,this.url=b,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.onComplete=undefined,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(a){this.options.decay&&(this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=a.responseText),this.timer=setTimeout(this.onTimerEvent.bind(this),this.decay*this.frequency*1e3)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),document.getElementsByClassName=function(a,b){var c=($(b)||document.body).getElementsByTagName("*");return $A(c).inject([],function(b,c){return c.className.match(new RegExp("(^|\\s)"+a+"(\\s|$)"))&&b.push(c),b})};if(!window.Element)var Element=new Object;Object.extend(Element,{visible:function(a){return $(a).style.display!="none"},toggle:function(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);Element[Element.visible(b)?"hide":"show"](b)}},hide:function(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display="none"}},show:function(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display=""}},remove:function(a){a=$(a),a.parentNode.removeChild(a)},update:function(a,b){$(a).innerHTML=b.stripScripts(),setTimeout(function(){b.evalScripts()},10)},getHeight:function(a){return a=$(a),a.offsetHeight},classNames:function(a){return new Element.ClassNames(a)},hasClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a).include(b)},addClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a).add(b)},removeClassName:function(a,b){if(!(a=$(a)))return;return Element.classNames(a).remove(b)},cleanWhitespace:function(a){a=$(a);for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];c.nodeType==3&&!/\S/.test(c.nodeValue)&&Element.remove(c)}},empty:function(a){return $(a).innerHTML.match(/^\s*$/)},scrollTo:function(a){a=$(a);var b=a.x?a.x:a.offsetLeft,c=a.y?a.y:a.offsetTop;window.scrollTo(b,c)},getStyle:function(a,b){a=$(a);var c=a.style[b.camelize()];if(!c)if(document.defaultView&&document.defaultView.getComputedStyle){var d=document.defaultView.getComputedStyle(a,null);c=d?d.getPropertyValue(b):null}else a.currentStyle&&(c=a.currentStyle[b.camelize()]);return window.opera&&["left","top","right","bottom"].include(b)&&Element.getStyle(a,"position")=="static"&&(c="auto"),c=="auto"?null:c},setStyle:function(a,b){a=$(a);for(name in b)a.style[name.camelize()]=b[name]},getDimensions:function(a){a=$(a);if(Element.getStyle(a,"display")!="none")return{width:a.offsetWidth,height:a.offsetHeight};var b=a.style,c=b.visibility,d=b.position;b.visibility="hidden",b.position="absolute",b.display="";var e=a.clientWidth,f=a.clientHeight;return b.display="none",b.position=d,b.visibility=c,{width:e,height:f}},makePositioned:function(a){a=$(a);var b=Element.getStyle(a,"position");if(b=="static"||!b)a._madePositioned=!0,a.style.position="relative",window.opera&&(a.style.top=0,a.style.left=0)},undoPositioned:function(a){a=$(a),a._madePositioned&&(a._madePositioned=undefined,a.style.position=a.style.top=a.style.left=a.style.bottom=a.style.right="")},makeClipping:function(a){a=$(a);if(a._overflow)return;a._overflow=a.style.overflow,(Element.getStyle(a,"overflow")||"visible")!="hidden"&&(a.style.overflow="hidden")},undoClipping:function(a){a=$(a);if(a._overflow)return;a.style.overflow=a._overflow,a._overflow=undefined}});var Toggle=new Object;Toggle.display=Element.toggle,Abstract.Insertion=function(a){this.adjacency=a},Abstract.Insertion.prototype={initialize:function(a,b){this.element=$(a),this.content=b.stripScripts();if(this.adjacency&&this.element.insertAdjacentHTML)try{this.element.insertAdjacentHTML(this.adjacency,this.content)}catch(c){if(this.element.tagName.toLowerCase()=="tbody")this.insertContent(this.contentFromAnonymousTable());else throw c}else this.range=this.element.ownerDocument.createRange(),this.initializeRange&&this.initializeRange(),this.insertContent([this.range.createContextualFragment(this.content)]);setTimeout(function(){b.evalScripts()},10)},contentFromAnonymousTable:function(){var a=document.createElement("div");return a.innerHTML="<table><tbody>"+this.content+"</tbody></table>",$A(a.childNodes[0].childNodes[0].childNodes)}};var Insertion=new Object;Insertion.Before=Class.create(),Insertion.Before.prototype=Object.extend(new Abstract.Insertion("beforeBegin"),{initializeRange:function(){this.range.setStartBefore(this.element)},insertContent:function(a){a.each(function(a){this.element.parentNode.insertBefore(a,this.element)}.bind(this))}}),Insertion.Top=Class.create(),Insertion.Top.prototype=Object.extend(new Abstract.Insertion("afterBegin"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(!0)},insertContent:function(a){a.reverse(!1).each(function(a){this.element.insertBefore(a,this.element.firstChild)}.bind(this))}}),Insertion.Bottom=Class.create(),Insertion.Bottom.prototype=Object.extend(new Abstract.Insertion("beforeEnd"),{initializeRange:function(){this.range.selectNodeContents(this.element),this.range.collapse(this.element)},insertContent:function(a){a.each(function(a){this.element.appendChild(a)}.bind(this))}}),Insertion.After=Class.create(),Insertion.After.prototype=Object.extend(new Abstract.Insertion("afterEnd"),{initializeRange:function(){this.range.setStartAfter(this.element)},insertContent:function(a){a.each(function(a){this.element.parentNode.insertBefore(a,this.element.nextSibling)}.bind(this))}}),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a){this.element.className.split(/\s+/).select(function(a){return a.length>0})._each(a)},set:function(a){this.element.className=a},add:function(a){if(this.include(a))return;this.set(this.toArray().concat(a).join(" "))},remove:function(a){if(!this.include(a))return;this.set(this.select(function(b){return b!=a}).join(" "))},toString:function(){return this.toArray().join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable);var Field={clear:function(){for(var a=0;a<arguments.length;a++)$(arguments[a]).value=""},focus:function(a){$(a).focus()},present:function(){for(var a=0;a<arguments.length;a++)if($(arguments[a]).value=="")return!1;return!0},select:function(a){$(a).select()},activate:function(a){a=$(a),a.focus(),a.select&&a.select()}},Form={serialize:function(a){var b=Form.getElements($(a)),c=new Array;for(var d=0;d<b.length;d++){var e=Form.Element.serialize(b[d]);e&&c.push(e)}return c.join("&")},getElements:function(a){a=$(a);var b=new Array;for(tagName in Form.Element.Serializers){var c=a.getElementsByTagName(tagName);for(var d=0;d<c.length;d++)b.push(c[d])}return b},getInputs:function(a,b,c){a=$(a);var d=a.getElementsByTagName("input");if(!b&&!c)return d;var e=new Array;for(var f=0;f<d.length;f++){var g=d[f];if(b&&g.type!=b||c&&g.name!=c)continue;e.push(g)}return e},disable:function(a){var b=Form.getElements(a);for(var c=0;c<b.length;c++){var d=b[c];d.blur(),d.disabled="true"}},enable:function(a){var b=Form.getElements(a);for(var c=0;c<b.length;c++){var d=b[c];d.disabled=""}},findFirstElement:function(a){return Form.getElements(a).find(function(a){return a.type!="hidden"&&!a.disabled&&["input","select","textarea"].include(a.tagName.toLowerCase())})},focusFirstElement:function(a){Field.activate(Form.findFirstElement(a))},reset:function(a){$(a).reset()}};Form.Element={serialize:function(a){a=$(a);var b=a.tagName.toLowerCase(),c=Form.Element.Serializers[b](a);if(c){var d=encodeURIComponent(c[0]);if(d.length==0)return;return c[1].constructor!=Array&&(c[1]=[c[1]]),c[1].map(function(a){return d+"="+encodeURIComponent(a)}).join("&")}},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase(),c=Form.Element.Serializers[b](a);if(c)return c[1]}},Form.Element.Serializers={input:function(a){switch(a.type.toLowerCase()){case"submit":case"hidden":case"password":case"text":return Form.Element.Serializers.textarea(a);case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(a)}return!1},inputSelector:function(a){if(a.checked)return[a.name,a.value]},textarea:function(a){return[a.name,a.value]},select:function(a){return Form.Element.Serializers[a.type=="select-one"?"selectOne":"selectMany"](a)},selectOne:function(a){var b="",c,d=a.selectedIndex;return d>=0&&(c=a.options[d],b=c.value,!b&&!("value"in c)&&(b=c.text)),[a.name,b]},selectMany:function(a){var b=new Array;for(var c=0;c<a.length;c++){var d=a.options[c];if(d.selected){var e=d.value;!e&&!("value"in d)&&(e=d.text),b.push(e)}}return[a.name,b]}};var $F=Form.Element.getValue;Abstract.TimedObserver=function(){},Abstract.TimedObserver.prototype={initialize:function(a,b,c){this.frequency=b,this.element=$(a),this.callback=c,this.lastValue=this.getValue(),this.registerCallback()},registerCallback:function(){setInterval(this.onTimerEvent.bind(this),this.frequency*1e3)},onTimerEvent:function(){var a=this.getValue();this.lastValue!=a&&(this.callback(this.element,a),this.lastValue=a)}},Form.Element.Observer=Class.create(),Form.Element.Observer.prototype=Object.extend(new Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(),Form.Observer.prototype=Object.extend(new Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=function(){},Abstract.EventObserver.prototype={initialize:function(a,b){this.element=$(a),this.callback=b,this.lastValue=this.getValue(),this.element.tagName.toLowerCase()=="form"?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();this.lastValue!=a&&(this.callback(this.element,a),this.lastValue=a)},registerFormCallbacks:function(){var a=Form.getElements(this.element);for(var b=0;b<a.length;b++)this.registerCallback(a[b])},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case"checkbox":case"radio":Event.observe(a,"click",this.onElementEvent.bind(this));break;case"password":case"text":case"textarea":case"select-one":case"select-multiple":Event.observe(a,"change",this.onElementEvent.bind(this))}}},Form.Element.EventObserver=Class.create(),Form.Element.EventObserver.prototype=Object.extend(new Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(),Form.EventObserver.prototype=Object.extend(new Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});if(!window.Event)var Event=new Object;Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isLeftClick:function(a){return a.which&&a.which==1||a.button&&a.button==1},pointerX:function(a){return a.pageX||a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)},pointerY:function(a){return a.pageY||a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)},stop:function(a){a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.returnValue=!1,a.cancelBubble=!0)},findElement:function(a,b){var c=Event.element(a);while(c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase()))c=c.parentNode;return c},observers:!1,_observeAndCache:function(a,b,c,d){this.observers||(this.observers=[]),a.addEventListener?(this.observers.push([a,b,c,d]),a.addEventListener(b,c,d)):a.attachEvent&&(this.observers.push([a,b,c,d]),a.attachEvent("on"+b,c))},unloadCache:function(){if(!Event.observers)return;for(var a=0;a<Event.observers.length;a++)Event.stopObserving.apply(this,Event.observers[a]),Event.observers[a][0]=null;Event.observers=!1},observe:function(a,b,c,d){var a=$(a);d=d||!1,b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(b="keydown"),this._observeAndCache(a,b,c,d)},stopObserving:function(a,b,c,d){var a=$(a);d=d||!1,b=="keypress"&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(b="keydown"),a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)}}),Event.observe(window,"unload",Event.unloadCache,!1);var Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},realOffset:function(a){var b=0,c=0;do b+=a.scrollTop||0,c+=a.scrollLeft||0,a=a.parentNode;while(a);return[c,b]},cumulativeOffset:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return[c,b]},positionedOffset:function(a){var b=0,c=0;do{b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;if(a){p=Element.getStyle(a,"position");if(p=="relative"||p=="absolute")break}}while(a);return[c,b]},offsetParent:function(a){if(a.offsetParent)return a.offsetParent;if(a==document.body)return a;while((a=a.parentNode)&&a!=document.body)if(Element.getStyle(a,"position")!="static")return a;return document.body},within:function(a,b,c){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(a,b,c):(this.xcomp=b,this.ycomp=c,this.offset=this.cumulativeOffset(a),c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth)},withinIncludingScrolloffsets:function(a,b,c){var d=this.realOffset(a);return this.xcomp=b+d[0]-this.deltaX,this.ycomp=c+d[1]-this.deltaY,this.offset=this.cumulativeOffset(a),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if(a=="vertical")return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if(a=="horizontal")return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},clone:function(a,b){a=$(a),b=$(b),b.style.position="absolute";var c=this.cumulativeOffset(a);b.style.top=c[1]+"px",b.style.left=c[0]+"px",b.style.width=a.offsetWidth+"px",b.style.height=a.offsetHeight+"px"},page:function(a){var b=0,c=0,d=a;do{b+=d.offsetTop||0,c+=d.offsetLeft||0;if(d.offsetParent==document.body&&Element.getStyle(d,"position")=="absolute")break}while(d=d.offsetParent);d=a;do b-=d.scrollTop||0,c-=d.scrollLeft||0;while(d=d.parentNode);return[c,b]},clone:function(a,b){var c=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[2]||{});a=$(a);var d=Position.page(a);b=$(b);var e=[0,0],f=null;Element.getStyle(b,"position")=="absolute"&&(f=Position.offsetParent(b),e=Position.page(f)),f==document.body&&(e[0]-=document.body.offsetLeft,e[1]-=document.body.offsetTop),c.setLeft&&(b.style.left=d[0]-e[0]+c.offsetLeft+"px"),c.setTop&&(b.style.top=d[1]-e[1]+c.offsetTop+"px"),c.setWidth&&(b.style.width=a.offsetWidth+"px"),c.setHeight&&(b.style.height=a.offsetHeight+"px")},absolutize:function(a){a=$(a);if(a.style.position=="absolute")return;Position.prepare();var b=Position.positionedOffset(a),c=b[1],d=b[0],e=a.clientWidth,f=a.clientHeight;a._originalLeft=d-parseFloat(a.style.left||0),a._originalTop=c-parseFloat(a.style.top||0),a._originalWidth=a.style.width,a._originalHeight=a.style.height,a.style.position="absolute",a.style.top=c+"px",a.style.left=d+"px",a.style.width=e+"px",a.style.height=f+"px"},relativize:function(a){a=$(a);if(a.style.position=="relative")return;Position.prepare(),a.style.position="relative";var b=parseFloat(a.style.top||0)-(a._originalTop||0),c=parseFloat(a.style.left||0)-(a._originalLeft||0);a.style.top=b+"px",a.style.left=c+"px",a.style.height=a._originalHeight,a.style.width=a._originalWidth}};/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(Position.cumulativeOffset=function(a){var b=0,c=0;do{b+=a.offsetTop||0,c+=a.offsetLeft||0;if(a.offsetParent==document.body&&Element.getStyle(a,"position")=="absolute")break;a=a.offsetParent}while(a);return[c,b]});var Behaviour={list:new Array,register:function(a){Behaviour.list.push(a)},start:function(){Behaviour.addLoadEvent(function(){Behaviour.apply()})},apply:function(){for(h=0;sheet=Behaviour.list[h];h++)for(selector in sheet){list=document.getElementsBySelector(selector);if(!list)continue;for(i=0;element=list[i];i++)sheet[selector](element)}},addLoadEvent:function(a){var b=window.onload;typeof window.onload!="function"?window.onload=a:window.onload=function(){b(),a()}}};Behaviour.start(),document.getElementsBySelector=function(a){if(!document.getElementsByTagName)return new Array;var b=a.split(" "),c=new Array(document);for(var d=0;d<b.length;d++){token=b[d].replace(/^\s+/,"").replace(/\s+$/,"");if(token.indexOf("#")>-1){var e=token.split("#"),f=e[0],g=e[1],h=document.getElementById(g);if(f&&h.nodeName.toLowerCase()!=f)return new Array;c=new Array(h);continue}if(token.indexOf(".")>-1){var e=token.split("."),f=e[0],i=e[1];f||(f="*");var j=new Array,k=0;for(var l=0;l<c.length;l++){var m;f=="*"?m=getAllChildren(c[l]):m=c[l].getElementsByTagName(f);for(var n=0;n<m.length;n++)j[k++]=m[n]}c=new Array;var o=0;for(var p=0;p<j.length;p++)j[p].className&&j[p].className.match(new RegExp("\\b"+i+"\\b"))&&(c[o++]=j[p]);continue}if(token.match(/^(\w*)\[(\w+)([=~\|\^\$\*]?)=?"?([^\]"]*)"?\]$/)){var f=RegExp.$1,q=RegExp.$2,r=RegExp.$3,s=RegExp.$4;f||(f="*");var j=new Array,k=0;for(var l=0;l<c.length;l++){var m;f=="*"?m=getAllChildren(c[l]):m=c[l].getElementsByTagName(f);for(var n=0;n<m.length;n++)j[k++]=m[n]}c=new Array;var o=0,t;switch(r){case"=":t=function(a){return a.getAttribute(q)==s};break;case"~":t=function(a){return a.getAttribute(q).match(new RegExp("\\b"+s+"\\b"))};break;case"|":t=function(a){return a.getAttribute(q).match(new RegExp("^"+s+"-?"))};break;case"^":t=function(a){return a.getAttribute(q).indexOf(s)==0};break;case"$":t=function(a){return a.getAttribute(q).lastIndexOf(s)==a.getAttribute(q).length-s.length};break;case"*":t=function(a){return a.getAttribute(q).indexOf(s)>-1};break;default:t=function(a){return a.getAttribute(q)}}c=new Array;var o=0;for(var p=0;p<j.length;p++)t(j[p])&&(c[o++]=j[p]);continue}if(!c[0])return;f=token;var j=new Array,k=0;for(var l=0;l<c.length;l++){var m=c[l].getElementsByTagName(f);for(var n=0;n<m.length;n++)j[k++]=m[n]}c=j}return c};var Fx=fx={};Fx.Base=function(){},Fx.Base.prototype={setOptions:function(a){this.options=Object.extend({onStart:function(){},onComplete:function(){},transition:Fx.Transitions.sineInOut,duration:500,unit:"px",wait:!0,fps:50},a||{})},step:function(){var a=(new Date).getTime();a<this.time+this.options.duration?(this.cTime=a-this.time,this.setNow()):(setTimeout(this.options.onComplete.bind(this,this.element),10),this.clearTimer(),this.now=this.to),this.increase()},setNow:function(){this.now=this.compute(this.from,this.to)},compute:function(a,b){var c=b-a;return this.options.transition(this.cTime,a,c,this.options.duration)},clearTimer:function(){return clearInterval(this.timer),this.timer=null,this},_start:function(a,b){this.options.wait||this.clearTimer();if(this.timer)return;return setTimeout(this.options.onStart.bind(this,this.element),10),this.from=a,this.to=b,this.time=(new Date).getTime(),this.timer=setInterval(this.step.bind(this),Math.round(1e3/this.options.fps)),this},custom:function(a,b){return this._start(a,b)},set:function(a){return this.now=a,this.increase(),this},hide:function(){return this.set(0)},setStyle:function(a,b,c){b=="opacity"?(c==0&&a.style.visibility!="hidden"?a.style.visibility="hidden":a.style.visibility!="visible"&&(a.style.visibility="visible"),window.ActiveXObject&&(a.style.filter="alpha(opacity="+c*100+")"),a.style.opacity=c):a.style[b]=c+this.options.unit}},Fx.Style=Class.create(),Fx.Style.prototype=Object.extend(new Fx.Base,{initialize:function(a,b,c){this.element=$(a),this.setOptions(c),this.property=b.camelize()},increase:function(){this.setStyle(this.element,this.property,this.now)}}),Fx.Styles=Class.create(),Fx.Styles.prototype=Object.extend(new Fx.Base,{initialize:function(a,b){this.element=$(a),this.setOptions(b),this.now={}},setNow:function(){for(p in this.from)this.now[p]=this.compute(this.from[p],this.to[p])},custom:function(a){if(this.timer&&this.options.wait)return;var b={},c={};for(p in a)b[p]=a[p][0],c[p]=a[p][1];return this._start(b,c)},increase:function(){for(var a in this.now)this.setStyle(this.element,a,this.now[a])}}),Fx.Transitions={linear:function(a,b,c,d){return c*a/d+b},sineInOut:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}},Fx.Scroll=Class.create(),Fx.Scroll.prototype=Object.extend(new Fx.Base,{initialize
:function(a,b){this.element=$(a),this.setOptions(b),this.element.style.overflow="hidden"},down:function(){return this.custom(this.element.scrollTop,this.element.scrollHeight-this.element.offsetHeight)},up:function(){return this.custom(this.element.scrollTop,0)},increase:function(){this.element.scrollTop=this.now}}),Fx.Color=Class.create(),Fx.Color.prototype=Object.extend(new Fx.Base,{initialize:function(a,b,c){this.element=$(a),this.setOptions(c),this.property=b.camelize(),this.now=[]},custom:function(a,b){return this._start(a.hexToRgb(!0),b.hexToRgb(!0))},setNow:function(){[0,1,2].each(function(a){this.now[a]=Math.round(this.compute(this.from[a],this.to[a]))}.bind(this))},increase:function(){this.element.style[this.property]="rgb("+this.now[0]+","+this.now[1]+","+this.now[2]+")"}}),Object.extend(String.prototype,{rgbToHex:function(a){var b=this.match(new RegExp("([\\d]{1,3})","g"));if(b[3]==0)return"transparent";var c=[];for(var d=0;d<3;d++){var e=(b[d]-0).toString(16);c.push(e.length==1?"0"+e:e)}var f="#"+c.join("");return a?c:f},hexToRgb:function(a){var b=this.match(new RegExp("^[#]{0,1}([\\w]{1,2})([\\w]{1,2})([\\w]{1,2})$")),c=[];for(var d=1;d<b.length;d++)b[d].length==1&&(b[d]+=b[d]),c.push(parseInt(b[d],16));var e="rgb("+c.join(",")+")";return a?c:e}});var count=0,app={url:"/ChatHandler",initialize:function(){$("login-name").focus(),app.listen()},listen:function(){$("comet-frame").src=app.url+"?"+count,count++},login:function(){var a=$F("login-name");if(!a.length>0){$("system-message").style.color="red",$("login-name").focus();return}$("system-message").style.color="#2d2b3d",$("system-message").innerHTML=a+":",$("login-button").disabled=!0,$("login-form").style.display="none",$("message-form").style.display="";var b="action=login&name="+encodeURI($F("login-name"));new Ajax.Request(app.url,{postBody:b,onSuccess:function(){$("message").focus()}})},post:function(){var a=$F("message");if(!a>0)return;$("message").disabled=!0,$("post-button").disabled=!0;var b="action=post&name="+encodeURI($F("login-name"))+"&message="+encodeURI(a);new Ajax.Request(app.url,{postBody:b,onComplete:function(){$("message").disabled=!1,$("post-button").disabled=!1,$("message").focus(),$("message").value=""}})},update:function(a){var b=document.createElement("p");b.innerHTML=a.name+":<br/>"+a.message,$("display").appendChild(b),(new Fx.Scroll("display")).down()}},rules={"#login-name":function(a){Event.observe(a,"keydown",function(a){a.keyCode==13&&$("login-button").focus()})},"#login-button":function(a){a.onclick=app.login},"#message":function(a){Event.observe(a,"keydown",function(a){a.shiftKey&&a.keyCode==13&&$("post-button").focus()})},"#post-button":function(a){a.onclick=app.post}};Behaviour.addLoadEvent(app.initialize),Behaviour.register(rules)